<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <!-- ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ì„ ìœ„í•œ í•„ìˆ˜ ë©”íƒ€ íƒœê·¸ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°”ì´ë¸” ë”¥ë‹¤ì´ë¸Œ (Swing2Appìš©)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ë°°ê²½ ë° í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Dark background */
            color: #e5e7eb; /* Light text */
        }
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (ê²°ê³¼ì°½) */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #374151; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #4f46e5; }

        /* API ê²°ê³¼ì°½ì˜ ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ë§ */
        .markdown-output h1, .markdown-output h2, .markdown-output h3 {
            font-weight: bold;
            color: #818cf8; /* Indigo/Violet for headers */
            padding-bottom: 5px;
            margin-top: 1.5rem;
            border-bottom: 1px solid #4b5563; /* Gray-600 */
        }
        .markdown-output p { margin-top: 0.5rem; }
        .markdown-output ul, .markdown-output ol { margin-left: 1.5rem; list-style-type: disc; }
        .markdown-output li { margin-bottom: 0.25rem; }
    </style>
</head>
<body class="p-0 m-0">
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ: ìµœëŒ€ ë„ˆë¹„ ì„¤ì •ìœ¼ë¡œ ëª¨ë°”ì¼ ì¤‘ì•™ ì •ë ¬ ìœ ì§€ -->
    <div id="app" class="w-full max-w-lg mx-auto bg-gray-800 min-h-screen shadow-2xl">
        <!-- Header: ìŠ¤í‹°í‚¤ í—¤ë”ë¡œ í™”ë©´ ìƒë‹¨ì— ê³ ì • -->
        <div class="p-4 border-b border-gray-700 flex items-center justify-between sticky top-0 bg-gray-800 z-10">
            <h1 class="text-xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-indigo-500">
                ë°”ì´ë¸” ë”¥ë‹¤ì´ë¸Œ (ë‹¤êµ­ì–´ ì§€ì›)
            </h1>
            <div class="flex items-center space-x-3">
                <!-- ì–¸ì–´ í† ê¸€ ë²„íŠ¼ -->
                <button id="lang-toggle" class="text-sm font-semibold p-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white transition shadow-md w-12">
                    KO
                </button>
                <!-- ê³µí†µ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ (ìƒë‹¨) -->
                <button id="back-button" class="text-white hover:text-cyan-400 transition hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <div id="content-area" class="p-4 pb-6">
            <!-- JavaScriptê°€ ì½˜í…ì¸ ë¥¼ ë Œë”ë§í•  ì˜ì—­ -->
        </div>

        <!-- í‘¸í„° ë²„íŠ¼ ì˜ì—­ (í•´ì„ ê²°ê³¼ í™”ë©´ì—ì„œë§Œ í‘œì‹œ) -->
        <div id="footer-button-area" class="p-4 border-t border-gray-700 hidden sticky bottom-0 bg-gray-800">
            <button id="footer-back-button" class="w-full py-3 bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-lg transition">
                ë‹¤ë¥¸ ì£¼ì œ ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>
    </div>

    <script>
        // --- 1. LLM API ì„¤ì • ë° ë°ì´í„° ---
        
        // ì£¼ì˜: Swing2App í™˜ê²½ì—ì„œëŠ” API Keyë¥¼ ì„œë²„ì—ì„œ ì§ì ‘ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë³´ì•ˆì— ë” ì¢‹ì§€ë§Œ, 
        // ì´ ì½”ë“œì—ì„œëŠ” Canvas í™˜ê²½ ì œì•½ì— ë”°ë¼ ë¹ˆ ë¬¸ìì—´ë¡œ ì²˜ë¦¬í•˜ë©°, ëŸ°íƒ€ì„ì— ìë™ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
        const API_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent`;
        const apiKey = "AIzaSyCZCW3eNWVeHigyPcy4m7ivH79gYgq2PAA"; 

        // ì•± ìƒíƒœ ê´€ë¦¬ ë³€ìˆ˜
        let language = 'ko'; // 'ko', 'en', 'zh'
        let view = 'HOME'; // 'HOME', 'SELECTION', 'PERSONALIZED_INPUT', 'INTERPRETATION'
        let category = null;
        let selectedItem = null;
        let contextualBook = { ko: 'ì°½ì„¸ê¸°', en: 'Genesis', zh: 'åˆ›ä¸–è®°' };
        let personalQuery = '';

        // --- ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ë°ì´í„° ---
        const UI_TEXT = {
            ko: {
                APP_TITLE: 'ë°”ì´ë¸” ë”¥ë‹¤ì´ë¸Œ (Bible Deep Dive)',
                LOADING_MESSAGE: 'ì‹¬ì¸µ í•´ì„¤ì„ ìƒì„± ì¤‘ì…ë‹ˆë‹¤... (ë„¤ ê°€ì§€ ì‹¤ì¡´ì  ì§ˆë¬¸ì— ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤)',
                EXPLORE_MESSAGE: 'ì„ íƒëœ ì£¼ì œì— ëŒ€í•œ ì¸ê°„ ì¡´ì¬ì˜ ì‹¬ì¸µ ì§ˆë¬¸ì„ íƒêµ¬í•©ë‹ˆë‹¤.',
                CATEGORY_SELECTION_TITLE: (name) => `${name} ì„ íƒ`,
                CUSTOM_TITLE: 'ë‚˜ì˜ ì§ˆë¬¸ì„ ì„±ê²½ì— ì ìš©í•˜ê¸°',
                CUSTOM_PROMPT_1: '1. ì–´ë–¤ ì„±ê²½ ë³¸ë¬¸ì˜ ë§¥ë½ì—ì„œ í•´ì„í•˜ê¸¸ ì›í•˜ì‹­ë‹ˆê¹Œ?',
                CUSTOM_PROMPT_2: '2. ë‹¹ì‹ ì˜ í˜„ëŒ€ì  ë”œë ˆë§ˆë‚˜ ì§ˆë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”:',
                CUSTOM_PLACEHOLDER: 'ì˜ˆ: ì €ëŠ” ì§ì¥ ë‚´ ë¶€ë‹¹í•¨ ë•Œë¬¸ì— ê³ í†µë°›ê³  ìˆìŠµë‹ˆë‹¤. ì œê°€ ì„ íƒí•œ ë³¸ë¬¸(ì˜ˆ: ìš¥ê¸°)ì€ ì´ ìƒí™©ì—ì„œ ì €ì—ê²Œ ì–´ë–¤ ë©”ì‹œì§€ë¥¼ ì¤„ ìˆ˜ ìˆì„ê¹Œìš”?',
                CUSTOM_BUTTON: 'ì‹¬ì¸µ í•´ì„ ìš”ì²­',
                ERROR_NO_QUERY: 'ë‹¹ì‹ ì˜ ì§ˆë¬¸ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.',
                ERROR_FETCH_FAIL: 'í•´ì„ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” API ìš”ì²­ ì‹œê°„ ì´ˆê³¼)',
                INTERPRETATION_TITLE: (cat, item) => `${cat} > ${item}`,
                SOURCE_TITLE: 'ì°¸ê³  ìë£Œ (Google Search Grounding)',
                BUTTON_BACK_SELECTION: 'ë‹¤ë¥¸ ì£¼ì œ ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°',
                BUTTON_BACK_PERSONALIZED: 'ì§ˆë¬¸ ìˆ˜ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°',
            },
            en: {
                APP_TITLE: 'Bible Deep Dive',
                LOADING_MESSAGE: 'Generating deep interpretation... (Focusing on four existential questions)',
                EXPLORE_MESSAGE: 'Explore the deep existential questions of human existence based on the selected topic.',
                CATEGORY_SELECTION_TITLE: (name) => `Select ${name}`,
                CUSTOM_TITLE: 'Apply My Question to the Bible',
                CUSTOM_PROMPT_1: '1. In the context of which biblical book would you like the interpretation?',
                CUSTOM_PROMPT_2: '2. Enter your modern dilemma or question:',
                CUSTOM_PLACEHOLDER: 'E.g., I am suffering from injustice at work. What message can the book I chose (e.g., Job) give me in this situation?',
                CUSTOM_BUTTON: 'Request Deep Interpretation',
                ERROR_NO_QUERY: 'Please enter your question.',
                ERROR_FETCH_FAIL: 'Failed to fetch interpretation. Please try again. (Network error or API timeout)',
                INTERPRETATION_TITLE: (cat, item) => `${cat} > ${item}`,
                SOURCE_TITLE: 'Sources (Google Search Grounding)',
                BUTTON_BACK_SELECTION: 'Go back to category selection',
                BUTTON_BACK_PERSONALIZED: 'Go back to edit query screen',
            },
            zh: {
                APP_TITLE: 'åœ£ç»æ·±åº¦æ½œæ°´ (Bible Deep Dive)',
                LOADING_MESSAGE: 'æ­£åœ¨ç”Ÿæˆæ·±åº¦è§£è¯»... (èšç„¦äºå››ä¸ªå­˜åœ¨ä¸»ä¹‰é—®é¢˜)',
                EXPLORE_MESSAGE: 'åŸºäºæ‰€é€‰ä¸»é¢˜æ¢ç´¢äººç±»å­˜åœ¨çš„æ·±åº¦å­˜åœ¨ä¸»ä¹‰é—®é¢˜ã€‚',
                CATEGORY_SELECTION_TITLE: (name) => `é€‰æ‹© ${name}`,
                CUSTOM_TITLE: 'å°†æˆ‘çš„é—®é¢˜åº”ç”¨äºåœ£ç»',
                CUSTOM_PROMPT_1: '1. æ‚¨å¸Œæœ›åœ¨å“ªä¸ªåœ£ç»ä¹¦å·çš„èƒŒæ™¯ä¸‹è¿›è¡Œè§£è¯»ï¼Ÿ',
                CUSTOM_PROMPT_2: '2. è¯·è¾“å…¥æ‚¨çš„ç°ä»£å›°å¢ƒæˆ–é—®é¢˜ï¼š',
                CUSTOM_PLACEHOLDER: 'ä¾‹å¦‚ï¼šæˆ‘æ­£åœ¨é­å—å·¥ä½œä¸­çš„ä¸å…¬æ­£å¾…é‡ã€‚æˆ‘é€‰æ‹©çš„ç»æ–‡ï¼ˆä¾‹å¦‚ï¼šçº¦ä¼¯è®°ï¼‰åœ¨è¿™ç§æƒ…å†µä¸‹èƒ½ç»™æˆ‘ä»€ä¹ˆä¿¡æ¯ï¼Ÿ',
                CUSTOM_BUTTON: 'è¯·æ±‚æ·±åº¦è§£è¯»',
                ERROR_NO_QUERY: 'è¯·è¾“å…¥æ‚¨çš„é—®é¢˜ã€‚',
                ERROR_FETCH_FAIL: 'è·å–è§£è¯»å¤±è´¥ã€‚è¯·é‡è¯•ã€‚ï¼ˆç½‘ç»œé”™è¯¯æˆ– API è¶…æ—¶ï¼‰',
                INTERPRETATION_TITLE: (cat, item) => `${cat} > ${item}`,
                SOURCE_TITLE: 'å‚è€ƒèµ„æ–™ (Google Search Grounding)',
                BUTTON_BACK_SELECTION: 'è¿”å›ä¸»é¢˜é€‰æ‹©ç”»é¢',
                BUTTON_BACK_PERSONALIZED: 'è¿”å›ä¿®æ”¹é—®é¢˜ç”»é¢',
            },
        };

        const CATEGORIES = [
            { id: 'BOOK', name_ko: 'ê¶Œë³„ í•´ì„', name_en: 'Book Interpretation', name_zh: 'ä¹¦å·è§£è¯»', icon: 'ğŸ“–' },
            { id: 'ERA', name_ko: 'ì‹œëŒ€ë³„ í•´ì„', name_en: 'Era Interpretation', name_zh: 'æ—¶ä»£è§£è¯»', icon: 'â³' },
            { id: 'PERSON', name_ko: 'ì¸ë¬¼ë³„ í•´ì„', name_en: 'Person Interpretation', name_zh: 'äººç‰©è§£è¯»', icon: 'ğŸ‘¤' },
            { id: 'STORY', name_ko: 'ìŠ¤í† ë¦¬/ì£¼ì œë³„ í•´ì„', name_en: 'Story/Theme Interpretation', name_zh: 'æ•…äº‹/ä¸»é¢˜è§£è¯»', icon: 'ğŸ“œ' },
            { id: 'THEOLOGY', name_ko: 'êµë¦¬ ì‹¬ì¸µ í•´ì„¤', name_en: 'Theology Deep Dive', name_zh: 'ç¥å­¦æ·±åº¦è§£è¯»', icon: 'ğŸ›ï¸' },
            { id: 'GEOGRAPHY', name_ko: 'ì„±ê²½ ì§€ë¦¬/ì—­ì‚¬ ë°°ê²½', name_en: 'Geography/History Background', name_zh: 'åœ°ç†/å†å²èƒŒæ™¯', icon: 'ğŸ—ºï¸' },
            { id: 'TYPOLOGY', name_ko: 'ë¹„êµ ìœ í˜•ë¡ ì  ê´€ì ', name_en: 'Comparative Typology', name_zh: 'æ¯”è¾ƒç±»å‹å­¦', icon: 'ğŸ”—' },
            { id: 'PERSONALIZED', name_ko: 'ë‚˜ì˜ ì§ˆë¬¸ ì ìš©', name_en: 'Apply My Question', name_zh: 'åº”ç”¨æˆ‘çš„é—®é¢˜', icon: 'ğŸ’¡' },
        ];
        
        const SELECTION_DATA = {
            BOOK: [
                { ko: 'ì°½ì„¸ê¸°', en: 'Genesis', zh: 'åˆ›ä¸–è®°' }, { ko: 'ì¶œì• êµ½ê¸°', en: 'Exodus', zh: 'å‡ºåŸƒåŠè®°' }, { ko: 'ë ˆìœ„ê¸°', en: 'Leviticus', zh: 'åˆ©æœªè®°' }, 
                { ko: 'ë¯¼ìˆ˜ê¸°', en: 'Numbers', zh: 'æ°‘æ•°è®°' }, { ko: 'ì‹ ëª…ê¸°', en: 'Deuteronomy', zh: 'ç”³å‘½è®°' }, { ko: 'ì—¬í˜¸ìˆ˜ì•„', en: 'Joshua', zh: 'çº¦ä¹¦äºšè®°' }, 
                { ko: 'ì‚¬ì‚¬ê¸°', en: 'Judges', zh: 'å£«å¸ˆè®°' }, { ko: 'ë£»ê¸°', en: 'Ruth', zh: 'è·¯å¾—è®°' }, { ko: 'ì‚¬ë¬´ì—˜ìƒ', en: '1 Samuel', zh: 'æ’’æ¯è€³è®°ä¸Š' }, 
                { ko: 'ì‚¬ë¬´ì—˜í•˜', en: '2 Samuel', zh: 'æ’’æ¯è€³è®°ä¸‹' }, { ko: 'ì—´ì™•ê¸°ìƒ', en: '1 Kings', zh: 'åˆ—ç‹çºªä¸Š' }, { ko: 'ì—´ì™•ê¸°í•˜', en: '2 Kings', zh: 'åˆ—ç‹çºªä¸‹' }, 
                { ko: 'ì—­ëŒ€ìƒ', en: '1 Chronicles', zh: 'å†ä»£å¿—ä¸Š' }, { ko: 'ì—­ëŒ€í•˜', en: '2 Chronicles', zh: 'å†ä»£å¿—ä¸‹' }, { ko: 'ì—ìŠ¤ë¼', en: 'Ezra', zh: 'ä»¥æ–¯æ‹‰è®°' },
                { ko: 'ëŠí—¤ë¯¸ì•¼', en: 'Nehemiah', zh: 'å°¼å¸Œç±³è®°' }, { ko: 'ì—ìŠ¤ë”', en: 'Esther', zh: 'ä»¥æ–¯å¸–è®°' }, { ko: 'ìš¥ê¸°', en: 'Job', zh: 'çº¦ä¼¯è®°' }, 
                { ko: 'ì‹œí¸', en: 'Psalms', zh: 'è¯—ç¯‡' }, { ko: 'ì ì–¸', en: 'Proverbs', zh: 'ç®´è¨€' }, { ko: 'ì „ë„ì„œ', en: 'Ecclesiastes', zh: 'ä¼ é“ä¹¦' },
                { ko: 'ì•„ê°€', en: 'Song of Solomon', zh: 'é›…æ­Œ' }, { ko: 'ì´ì‚¬ì•¼', en: 'Isaiah', zh: 'ä»¥èµ›äºšä¹¦' }, { ko: 'ì˜ˆë ˆë¯¸ì•¼', en: 'Jeremiah', zh: 'è€¶åˆ©ç±³ä¹¦' }, 
                { ko: 'ì˜ˆë ˆë¯¸ì•¼ì• ê°€', en: 'Lamentations', zh: 'è€¶åˆ©ç±³å“€æ­Œ' }, { ko: 'ì—ìŠ¤ê²”', en: 'Ezekiel', zh: 'ä»¥è¥¿ç»“ä¹¦' }, { ko: 'ë‹¤ë‹ˆì—˜', en: 'Daniel', zh: 'ä½†ä»¥ç†ä¹¦' }, 
                { ko: 'í˜¸ì„¸ì•„', en: 'Hosea', zh: 'ä½•è¥¿é˜¿ä¹¦' }, { ko: 'ìš”ì—˜', en: 'Joel', zh: 'çº¦ç¥ä¹¦' }, { ko: 'ì•„ëª¨ìŠ¤', en: 'Amos', zh: 'é˜¿æ‘©å¸ä¹¦' },
                { ko: 'ì˜¤ë°”ëŒœ', en: 'Obadiah', zh: 'ä¿„å·´åº•äºšä¹¦' }, { ko: 'ìš”ë‚˜', en: 'Jonah', zh: 'çº¦æ‹¿ä¹¦' }, { ko: 'ë¯¸ê°€', en: 'Micah', zh: 'å¼¥è¿¦ä¹¦' }, 
                { ko: 'ë‚˜í›”', en: 'Nahum', zh: 'é‚£é¸¿ä¹¦' }, { ko: 'í•˜ë°•êµ­', en: 'Habakkuk', zh: 'å“ˆå·´è°·ä¹¦' }, { ko: 'ìŠ¤ë°”ëƒ', en: 'Zephaniah', zh: 'è¥¿ç•ªé›…ä¹¦' },
                { ko: 'í•™ê°œ', en: 'Haggai', zh: 'å“ˆè¯¥ä¹¦' }, { ko: 'ìŠ¤ê°€ë´', en: 'Zechariah', zh: 'æ’’è¿¦åˆ©äºšä¹¦' }, { ko: 'ë§ë¼ê¸°', en: 'Malachi', zh: 'ç›æ‹‰åŸºä¹¦' },
                { ko: 'ë§ˆíƒœë³µìŒ', en: 'Matthew', zh: 'é©¬å¤ªç¦éŸ³' }, { ko: 'ë§ˆê°€ë³µìŒ', en: 'Mark', zh: 'é©¬å¯ç¦éŸ³' }, { ko: 'ëˆ„ê°€ë³µìŒ', en: 'Luke', zh: 'è·¯åŠ ç¦éŸ³' }, 
                { ko: 'ìš”í•œë³µìŒ', en: 'John', zh: 'çº¦ç¿°ç¦éŸ³' }, { ko: 'ì‚¬ë„í–‰ì „', en: 'Acts', zh: 'ä½¿å¾’è¡Œä¼ ' }, { ko: 'ë¡œë§ˆì„œ', en: 'Romans', zh: 'ç½—é©¬ä¹¦' }, 
                { ko: 'ê³ ë¦°ë„ì „ì„œ', en: '1 Corinthians', zh: 'å“¥æ—å¤šå‰ä¹¦' }, { ko: 'ê³ ë¦°ë„í›„ì„œ', en: '2 Corinthians', zh: 'å“¥æ—å¤šåä¹¦' }, { ko: 'ê°ˆë¼ë””ì•„ì„œ', en: 'Galatians', zh: 'åŠ æ‹‰å¤ªä¹¦' }, 
                { ko: 'ì—ë² ì†Œì„œ', en: 'Ephesians', zh: 'ä»¥å¼—æ‰€ä¹¦' }, { ko: 'ë¹Œë¦½ë³´ì„œ', en: 'Philippians', zh: 'è…“ç«‹æ¯”ä¹¦' }, { ko: 'ê³¨ë¡œìƒˆì„œ', en: 'Colossians', zh: 'æ­Œç½—è¥¿ä¹¦' }, 
                { ko: 'ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ', en: '1 Thessalonians', zh: 'å¸–æ’’ç½—å°¼è¿¦å‰ä¹¦' }, { ko: 'ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ', en: '2 Thessalonians', zh: 'å¸–æ’’ç½—å°¼è¿¦åä¹¦' }, { ko: 'ë””ëª¨ë°ì „ì„œ', en: '1 Timothy', zh: 'ææ‘©å¤ªå‰ä¹¦' },
                { ko: 'ë””ëª¨ë°í›„ì„œ', en: '2 Timothy', zh: 'ææ‘©å¤ªåä¹¦' }, { ko: 'ë””ë„ì„œ', en: 'Titus', zh: 'æå¤šä¹¦' }, { ko: 'ë¹Œë ˆëª¬ì„œ', en: 'Philemon', zh: 'è…“åˆ©é—¨ä¹¦' }, 
                { ko: 'íˆë¸Œë¦¬ì„œ', en: 'Hebrews', zh: 'å¸Œä¼¯æ¥ä¹¦' }, { ko: 'ì•¼ê³ ë³´ì„œ', en: 'James', zh: 'é›…å„ä¹¦' }, { ko: 'ë² ë“œë¡œì „ì„œ', en: '1 Peter', zh: 'å½¼å¾—å‰ä¹¦' }, 
                { ko: 'ë² ë“œë¡œí›„ì„œ', en: '2 Peter', zh: 'å½¼å¾—åä¹¦' }, { ko: 'ìš”í•œì¼ì„œ', en: '1 John', zh: 'çº¦ç¿°ä¸€ä¹¦' }, { ko: 'ìš”í•œì´ì„œ', en: '2 John', zh: 'çº¦ç¿°äºŒä¹¦' }, 
                { ko: 'ìš”í•œì‚¼ì„œ', en: '3 John', zh: 'çº¦ç¿°ä¸‰ä¹¦' }, { ko: 'ìœ ë‹¤ì„œ', en: 'Jude', zh: 'çŠ¹å¤§ä¹¦' }, { ko: 'ìš”í•œê³„ì‹œë¡', en: 'Revelation', zh: 'å¯ç¤ºå½•' },
            ],
            ERA: [
                { ko: '1. ì°½ì¡° ì‹œëŒ€', en: '1. Creation Era', zh: '1. åˆ›é€ æ—¶ä»£' }, { ko: '2. ì¡±ì¥ ì‹œëŒ€', en: '2. Patriarchs Era', zh: '2. åˆ—ç¥–æ—¶ä»£' }, 
                { ko: '3. ì¶œì• êµ½ ì‹œëŒ€', en: '3. Exodus Era', zh: '3. å‡ºåŸƒåŠæ—¶ä»£' }, { ko: '4. ê´‘ì•¼ ì‹œëŒ€', en: '4. Wilderness Era', zh: '4. æ—·é‡æ—¶ä»£' },
                { ko: '5. ì •ë³µ ì‹œëŒ€', en: '5. Conquest Era', zh: '5. å¾æœæ—¶ä»£' }, { ko: '6. ì‚¬ì‚¬ ì‹œëŒ€', en: '6. Judges Era', zh: '6. å£«å¸ˆæ—¶ä»£' }, 
                { ko: '7. í†µì¼ ì™•êµ­ ì‹œëŒ€', en: '7. United Kingdom Era', zh: '7. è”åˆç‹å›½æ—¶ä»£' }, { ko: '8. ë¶„ì—´ ì™•êµ­ ì‹œëŒ€', en: '8. Divided Kingdom Era', zh: '8. åˆ†è£‚ç‹å›½æ—¶ä»£' },
                { ko: '9. í¬ë¡œ ì‹œëŒ€', en: '9. Exile Era', zh: '9. è¢«æ³æ—¶ä»£' }, { ko: '10. ê·€í™˜ ì‹œëŒ€', en: '10. Return Era', zh: '10. å½’å›æ—¶ä»£' }, 
                { ko: '11. ì¤‘ê°„ê¸°/ì¹¨ë¬µ ì‹œëŒ€', en: '11. Intertestamental Period', zh: '11. ä¸¤çº¦ä¸­é—´æœŸ/æ²‰é»˜æ—¶ä»£' }, { ko: '12. ì‹ ì•½ ì‹œëŒ€', en: '12. New Testament/Church Age', zh: '12. æ–°çº¦æ—¶ä»£/æ•™ä¼šæ—¶ä»£' },
            ],
            PERSON: [
                { ko: 'ì•„ë‹´ê³¼ í•˜ì™€', en: 'Adam & Eve', zh: 'äºšå½“ä¸å¤å¨ƒ' }, { ko: 'ë…¸ì•„', en: 'Noah', zh: 'æŒªäºš' }, { ko: 'ì•„ë¸Œë¼í•¨', en: 'Abraham', zh: 'äºšä¼¯æ‹‰ç½•' }, 
                { ko: 'ì‚¬ë¼', en: 'Sarah', zh: 'æ’’æ‹‰' }, { ko: 'ì´ì‚­', en: 'Isaac', zh: 'ä»¥æ’’' }, { ko: 'ë¦¬ë¸Œê°€', en: 'Rebekah', zh: 'åˆ©ç™¾åŠ ' },
                { ko: 'ì•¼ê³±', en: 'Jacob', zh: 'é›…å„' }, { ko: 'ë¼í—¬', en: 'Rachel', zh: 'æ‹‰ç»“' }, { ko: 'ìš”ì…‰', en: 'Joseph', zh: 'çº¦ç‘Ÿ' }, 
                { ko: 'ëª¨ì„¸', en: 'Moses', zh: 'æ‘©è¥¿' }, { ko: 'ì•„ë¡ ', en: 'Aaron', zh: 'äºšä¼¦' }, { ko: 'ë¯¸ë¦¬ì•”', en: 'Miriam', zh: 'ç±³åˆ©æš—' },
                { ko: 'ì—¬í˜¸ìˆ˜ì•„', en: 'Joshua', zh: 'çº¦ä¹¦äºš' }, { ko: 'ë¼í•©', en: 'Rahab', zh: 'å–‡åˆ' }, { ko: 'ë“œë³´ë¼', en: 'Deborah', zh: 'åº•æ³¢æ‹‰' }, 
                { ko: 'ê¸°ë“œì˜¨', en: 'Gideon', zh: 'åŸºç”¸' }, { ko: 'ì‚¼ì†', en: 'Samson', zh: 'å‚å­™' }, { ko: 'ë£»', en: 'Ruth', zh: 'è·¯å¾—' }, { ko: 'ë‚˜ì˜¤ë¯¸', en: 'Naomi', zh: 'æ‹¿ä¿„ç±³' },
                { ko: 'ì—˜ë¦¬', en: 'Eli', zh: 'ä»¥åˆ©' }, { ko: 'ì‚¬ë¬´ì—˜', en: 'Samuel', zh: 'æ’’æ¯è€³' }, { ko: 'ì‚¬ìš¸', en: 'Saul', zh: 'æ‰«ç½—' }, 
                { ko: 'ìš”ë‚˜ë‹¨', en: 'Jonathan', zh: 'çº¦æ‹¿å•' }, { ko: 'ë‹¤ìœ—', en: 'David', zh: 'å¤§å«' }, { ko: 'ë°§ì„¸ë°”', en: 'Bathsheba', zh: 'æ‹”ç¤ºå·´' }, { ko: 'ì†”ë¡œëª¬', en: 'Solomon', zh: 'æ‰€ç½—é—¨' },
                { ko: 'ì—˜ë¦¬ì•¼', en: 'Elijah', zh: 'ä»¥åˆ©äºš' }, { ko: 'ì—˜ë¦¬ì‚¬', en: 'Elisha', zh: 'ä»¥åˆ©æ²™' }, { ko: 'ë‚˜ì•„ë§Œ', en: 'Naaman', zh: 'ä¹ƒç¼¦' }, { ko: 'íˆìŠ¤ê¸°ì•¼', en: 'Hezekiah', zh: 'å¸Œè¥¿å®¶' },
                { ko: 'ì—ìŠ¤ë”', en: 'Esther', zh: 'ä»¥æ–¯å¸–' }, { ko: 'ëª¨ë¥´ë“œê°œ', en: 'Mordecai', zh: 'æœ«åº•æ”¹' }, { ko: 'ëŠí—¤ë¯¸ì•¼', en: 'Nehemiah', zh: 'å°¼å¸Œç±³' }, { ko: 'ë‹¤ë‹ˆì—˜', en: 'Daniel', zh: 'ä½†ä»¥ç†' },
                { ko: 'ì„¸ë¡€ ìš”í•œ', en: 'John the Baptist', zh: 'æ–½æ´—çº¦ç¿°' }, { ko: 'ë§ˆë¦¬ì•„ (ì˜ˆìˆ˜ë‹˜ì˜ ì–´ë¨¸ë‹ˆ)', en: 'Mary (Mother of Jesus)', zh: 'é©¬åˆ©äºš (è€¶ç¨£çš„æ¯äº²)' }, 
                { ko: 'ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„', en: 'Jesus Christ', zh: 'è€¶ç¨£åŸºç£' }, { ko: 'ë² ë“œë¡œ', en: 'Peter', zh: 'å½¼å¾—' }, { ko: 'ìš”í•œ', en: 'John', zh: 'çº¦ç¿°' },
                { ko: 'ë§ˆë¦¬ì•„ ë§‰ë‹¬ë ˆë‚˜', en: 'Mary Magdalene', zh: 'æŠ¹å¤§æ‹‰çš„é©¬åˆ©äºš' }, { ko: 'ì‚¬ë§ˆë¦¬ì•„ ì—¬ì¸', en: 'Samaritan Woman', zh: 'æ’’ç›åˆ©äºšå¦‡äºº' }, 
                { ko: 'ë°”ìš¸', en: 'Paul', zh: 'ä¿ç½—' }, { ko: 'ë°”ë‚˜ë°”', en: 'Barnabas', zh: 'å·´æ‹¿å·´' },
                { ko: 'ë””ëª¨ë°', en: 'Timothy', zh: 'ææ‘©å¤ª' }, { ko: 'ë£¨ë””ì•„', en: 'Lydia', zh: 'å•åº•äºš' }, 
                { ko: 'ì•„êµ´ë¼ì™€ ë¸Œë¦¬ìŠ¤ê¸¸ë¼', en: 'Aquila & Priscilla', zh: 'äºšå±…æ‹‰ä¸ç™¾åŸºæ‹‰' }, { ko: 'ìš”í•œ (ìš”í•œê³„ì‹œë¡ì˜ ì €ì)', en: 'John (Author of Revelation)', zh: 'çº¦ç¿° (å¯ç¤ºå½•ä½œè€…)' },
            ],
            STORY: [
                { ko: 'ì°½ì¡°ì™€ ì¸ê°„ì˜ íƒ€ë½', en: 'Creation and Fall of Humanity', zh: 'åˆ›é€ ä¸äººç±»çš„å •è½' }, { ko: 'ê°€ì¸ê³¼ ì•„ë²¨', en: 'Cain and Abel', zh: 'è¯¥éšä¸äºšä¼¯' }, 
                { ko: 'ë…¸ì•„ì˜ í™ìˆ˜ì™€ ì–¸ì•½', en: 'Noah\'s Flood and Covenant', zh: 'æŒªäºšçš„æ´ªæ°´ä¸ç›Ÿçº¦' }, { ko: 'ë°”ë²¨íƒ‘ ì‚¬ê±´', en: 'The Tower of Babel', zh: 'å·´åˆ«å¡”äº‹ä»¶' }, 
                { ko: 'ì•„ë¸Œë¼í•¨ì˜ ë¶€ë¥´ì‹¬ê³¼ ë¯¿ìŒ', en: 'Abraham\'s Call and Faith', zh: 'äºšä¼¯æ‹‰ç½•çš„å‘¼å¬ä¸ä¿¡å¿ƒ' }, { ko: 'ì´ì‚­ í—Œì‹ ', en: 'Sacrifice of Isaac', zh: 'ä»¥æ’’çš„çŒ®ç¥­' },
                { ko: 'ì•¼ê³±ì˜ ì”¨ë¦„ê³¼ ì´ìŠ¤ë¼ì—˜', en: 'Jacob\'s Wrestling and Israel', zh: 'é›…å„çš„æ‘”è·¤ä¸ä»¥è‰²åˆ—' }, { ko: 'ìš”ì…‰ì˜ ê¿ˆê³¼ êµ¬ì›', en: 'Joseph\'s Dreams and Salvation', zh: 'çº¦ç‘Ÿçš„æ¢¦ä¸æ‹¯æ•‘' },
                { ko: 'ì¶œì• êµ½ ì‚¬ê±´ê³¼ í•´ë°©', en: 'The Exodus and Liberation', zh: 'å‡ºåŸƒåŠäº‹ä»¶ä¸è§£æ”¾' }, { ko: 'ì‹œë‚´ ì‚° ì–¸ì•½ê³¼ ìœ¨ë²•', en: 'The Sinai Covenant and Law', zh: 'è¥¿å¥ˆå±±ä¹‹çº¦ä¸å¾‹æ³•' }, 
                { ko: 'ê´‘ì•¼ 40ë…„ì˜ ì˜ë¯¸', en: 'The Meaning of 40 Years in the Wilderness', zh: 'æ—·é‡å››åå¹´ä¹‹æ„ä¹‰' }, { ko: 'ì—¬ë¦¬ê³  ì •ë³µ', en: 'Conquest of Jericho', zh: 'è€¶åˆ©å“¥çš„å¾æœ' }, 
                { ko: 'ì‚¬ì‚¬ ì‹œëŒ€ì˜ ë°˜ë³µë˜ëŠ” ì£„ì™€ êµ¬ì›', en: 'The Cycle of Sin and Salvation in the Judges Era', zh: 'å£«å¸ˆæ—¶ä»£åå¤çš„ç½ªä¸æ•‘èµ' }, { ko: 'ë£»ê³¼ ë³´ì•„ìŠ¤ ì´ì•¼ê¸°', en: 'The Story of Ruth and Boaz', zh: 'è·¯å¾—ä¸æ³¢é˜¿æ–¯çš„æ•…äº‹' },
                { ko: 'ì‚¬ë¬´ì—˜ì˜ ì†Œëª…', en: 'Samuel\'s Calling', zh: 'æ’’æ¯è€³çš„å‘¼å¬' }, { ko: 'ë‹¤ìœ—ê³¼ ê³¨ë¦¬ì•—', en: 'David and Goliath', zh: 'å¤§å«ä¸æ­Œåˆ©äºš' }, 
                { ko: 'ë‹¤ìœ— ì–¸ì•½ê³¼ ì™•êµ­', en: 'The Davidic Covenant and Kingdom', zh: 'å¤§å«ä¹‹çº¦ä¸ç‹å›½' }, { ko: 'ì†”ë¡œëª¬ì˜ ì§€í˜œì™€ ëª°ë½', en: 'Solomon\'s Wisdom and Fall', zh: 'æ‰€ç½—é—¨çš„æ™ºæ…§ä¸å •è½' }, 
                { ko: 'ì—˜ë¦¬ì•¼ì™€ ë°”ì•Œ ì„ ì§€ì ëŒ€ê²°', en: 'Elijah vs. Prophets of Baal', zh: 'ä»¥åˆ©äºšä¸å·´åŠ›å…ˆçŸ¥çš„å¯¹æŠ—' },
                { ko: 'ë°”ë²¨ë¡  í¬ë¡œ ìƒí™œì˜ ì˜ë¯¸', en: 'The Meaning of the Babylonian Exile', zh: 'å·´æ¯”ä¼¦è¢«æ³ç”Ÿæ´»ä¹‹æ„ä¹‰' }, { ko: 'ë‹¤ë‹ˆì—˜ì˜ ì„¸ ì¹œêµ¬ì™€ ë¯¿ìŒ', en: 'Daniel\'s Three Friends and Faith', zh: 'ä½†ä»¥ç†çš„ä¸‰ä¸ªæœ‹å‹ä¸ä¿¡å¿ƒ' }, 
                { ko: 'ì—ìŠ¤ë”ì˜ êµ¬ì›', en: 'Esther\'s Salvation', zh: 'ä»¥æ–¯å¸–çš„æ‹¯æ•‘' }, { ko: 'ëŠí—¤ë¯¸ì•¼ì˜ ì„±ë²½ ì¬ê±´', en: 'Nehemiah Rebuilding the Wall', zh: 'å°¼å¸Œç±³é‡å»ºåŸå¢™' },
                { ko: 'ì˜ˆìˆ˜ì˜ íƒ„ìƒê³¼ ì„±ìœ¡ì‹ ', en: 'The Birth and Incarnation of Jesus', zh: 'è€¶ç¨£çš„è¯ç”Ÿä¸é“æˆè‚‰èº«' }, { ko: 'ì‚°ìƒìˆ˜í›ˆ', en: 'The Sermon on the Mount', zh: 'ç™»å±±å®è®­' }, 
                { ko: 'ì˜ˆìˆ˜ì˜ ê¸°ì ê³¼ ê¶Œìœ„', en: 'Jesus\' Miracles and Authority', zh: 'è€¶ç¨£çš„ç¥è¿¹ä¸æƒæŸ„' }, { ko: 'ì‹­ìê°€ì™€ ë¶€í™œ', en: 'The Cross and Resurrection', zh: 'åå­—æ¶ä¸å¤æ´»' }, 
                { ko: 'ì„±ë ¹ ê°•ë¦¼ê³¼ êµíšŒì˜ ì‹œì‘', en: 'Pentecost and the Start of the Church', zh: 'åœ£çµé™ä¸´ä¸æ•™ä¼šçš„å¼€å§‹' },
                { ko: 'ë°”ìš¸ì˜ íšŒì‹¬ê³¼ ì„ êµ', en: 'Paul\'s Conversion and Mission', zh: 'ä¿ç½—çš„å½’ä¿¡ä¸å®£æ•™' }, { ko: 'ë¯¿ìŒìœ¼ë¡œ ë§ë¯¸ì•”ëŠ” êµ¬ì›', en: 'Salvation by Faith', zh: 'å› ä¿¡ç§°ä¹‰çš„æ•‘æ©' }, 
                { ko: 'ìµœí›„ì˜ ì‹¬íŒê³¼ ìƒˆ í•˜ëŠ˜ê³¼ ìƒˆ ë•…', en: 'The Final Judgment and New Creation', zh: 'æœ«æ—¥å®¡åˆ¤ä¸æ–°å¤©æ–°åœ°' },
            ],
            THEOLOGY: [
                { ko: 'ì‚¼ìœ„ì¼ì²´ë¡ ', en: 'The Trinity', zh: 'ä¸‰ä½ä¸€ä½“è®º' }, { ko: 'ì„±ë ¹ë¡ ', en: 'Pneumatology', zh: 'åœ£çµè®º' }, { ko: 'ì‹ ë¡ ', en: 'Theology Proper', zh: 'ç¥è®º' },
                { ko: 'ê¸°ë…ë¡ ', en: 'Christology', zh: 'åŸºç£è®º' }, { ko: 'ì¸ê°„ë¡ ', en: 'Anthropology', zh: 'äººè®º' }, { ko: 'êµ¬ì›ë¡ ', en: 'Soteriology', zh: 'æ•‘æ©è®º' }, 
                { ko: 'êµíšŒë¡ ', en: 'Ecclesiology', zh: 'æ•™ä¼šè®º' }, { ko: 'ì¢…ë§ë¡ ', en: 'Eschatology', zh: 'æœ«ä¸–è®º' }, { ko: 'ì–¸ì•½ ì‹ í•™', en: 'Covenant Theology', zh: 'åœ£çº¦ç¥å­¦' },
            ],
            GEOGRAPHY: [
                { ko: 'ë©”ì†Œí¬íƒ€ë¯¸ì•„ ë¬¸ëª…ê³¼ ê°ˆëŒ€ì•„ ìš°ë¥´', en: 'Mesopotamian Civilization and Ur of the Chaldeans', zh: 'ç¾ç´¢ä¸è¾¾ç±³äºšæ–‡æ˜ä¸è¿¦å‹’åº•çš„å¾ç¥' }, 
                { ko: 'ì• êµ½(ì´ì§‘íŠ¸)ê³¼ ì¶œì• êµ½ ê²½ë¡œ', en: 'Egypt and the Exodus Route', zh: 'åŸƒåŠä¸å‡ºåŸƒåŠè·¯çº¿' }, 
                { ko: 'ì‹œë‚´ ê´‘ì•¼ì™€ 40ë…„ ì—¬ì •ì˜ ì˜ë¯¸', en: 'The Sinai Wilderness and the Meaning of the 40-Year Journey', zh: 'è¥¿å¥ˆæ—·é‡ä¸å››åå¹´æ—…ç¨‹çš„æ„ä¹‰' },
                { ko: 'ê°€ë‚˜ì•ˆ ë•…ì˜ ì§€ë¦¬ì  íŠ¹ì§•ê³¼ ì¤‘ìš”ì„±', en: 'Geographical Features and Importance of the Land of Canaan', zh: 'è¿¦å—åœ°çš„åœ°ç†ç‰¹å¾ä¸é‡è¦æ€§' }, 
                { ko: 'ê°ˆë¦´ë¦¬ ë°”ë‹¤ì™€ ì˜ˆìˆ˜ë‹˜ì˜ ì‚¬ì—­', en: 'The Sea of Galilee and Jesus\' Ministry', zh: 'åŠ åˆ©åˆ©æµ·ä¸è€¶ç¨£çš„äº‹å·¥' }, 
                { ko: 'ì˜ˆë£¨ì‚´ë ˜ ì„±ì „ì˜ ì—­ì‚¬ì  ë°°ê²½', en: 'Historical Background of the Jerusalem Temple', zh: 'è€¶è·¯æ’’å†·åœ£æ®¿çš„å†å²èƒŒæ™¯' },
                { ko: 'ë¡œë§ˆ ì œêµ­ì˜ íŒìŠ¤ ë¡œë§ˆë‚˜ ì‹œëŒ€', en: 'Pax Romana Era of the Roman Empire', zh: 'ç½—é©¬å¸å›½çš„ç½—é©¬å’Œå¹³æ—¶ä»£' }, 
                { ko: 'ë°”ë²¨ë¡  í¬ë¡œê¸° ë°°ê²½ê³¼ í˜ë¥´ì‹œì•„ ì œêµ­', en: 'The Context of the Babylonian Exile and the Persian Empire', zh: 'å·´æ¯”ä¼¦è¢«æ³èƒŒæ™¯ä¸æ³¢æ–¯å¸å›½' }, 
                { ko: 'í—¬ë¼ ë¬¸í™” (í—¬ë ˆë‹ˆì¦˜)ì˜ ì˜í–¥', en: 'The Influence of Greek Culture (Hellenism)', zh: 'å¸Œè…Šæ–‡åŒ–ï¼ˆå¸Œè…ŠåŒ–ï¼‰çš„å½±å“' },
            ],
            TYPOLOGY: [
                { ko: 'ë©œê¸°ì„¸ë±ì˜ ëŒ€ì œì‚¬ì¥ì§ ì˜ˆí‘œ', en: 'Melchizedek\'s Prefiguration of the High Priesthood', zh: 'éº¦åŸºæ´—å¾·é¢„è¡¨å¤§ç¥­å¸èŒä»»' }, 
                { ko: 'ë†‹ë±€ê³¼ ì‹­ìê°€ì˜ ì˜ˆí‘œ', en: 'The Bronze Serpent and the Prefiguration of the Cross', zh: 'é“œè›‡ä¸åå­—æ¶çš„é¢„è¡¨' }, 
                { ko: 'ìœ ì›”ì ˆ ì–´ë¦°ì–‘ê³¼ ì˜ˆìˆ˜ ê·¸ë¦¬ìŠ¤ë„', en: 'The Passover Lamb and Jesus Christ', zh: 'é€¾è¶ŠèŠ‚çš„ç¾”ç¾Šä¸è€¶ç¨£åŸºç£' },
                { ko: 'ì•„ë‹´ê³¼ ë§ˆì§€ë§‰ ì•„ë‹´ (ì˜ˆìˆ˜)', en: 'Adam and the Last Adam (Jesus)', zh: 'äºšå½“ä¸æœ«åçš„äºšå½“ï¼ˆè€¶ç¨£ï¼‰' }, 
                { ko: 'ë…¸ì•„ì˜ ë°©ì£¼ì™€ êµíšŒ', en: 'Noah\'s Ark and the Church', zh: 'æŒªäºšæ–¹èˆŸä¸æ•™ä¼š' }, 
                { ko: 'í™í•´ì˜ ê¸°ì ê³¼ ì„¸ë¡€', en: 'The Miracle of the Red Sea and Baptism', zh: 'çº¢æµ·ç¥è¿¹ä¸æ´—ç¤¼' },
                { ko: 'ë§Œë‚˜ì™€ ìƒëª…ì˜ ë–¡ (ì˜ˆìˆ˜)', en: 'Manna and the Bread of Life (Jesus)', zh: 'å—å“ªä¸ç”Ÿå‘½çš„ç²®ï¼ˆè€¶ç¨£ï¼‰' }, 
                { ko: 'ì„±ë§‰ê³¼ ì§€ì„±ì†Œì˜ ì˜ë¯¸', en: 'The Meaning of the Tabernacle and the Holy of Holies', zh: 'ä¼šå¹•ä¸è‡³åœ£æ‰€çš„æ„ä¹‰' },
            ],
        };

        const getUIText = (key, lang = language, ...args) => {
            const text = UI_TEXT[lang] ? UI_TEXT[lang][key] : UI_TEXT['ko'][key];
            return typeof text === 'function' ? text(...args) : text;
        };

        const getLocalizedItemName = (item, lang = language) => {
            return item[lang] || item['en'];
        };

        const getLLMQueryTopic = (item) => {
            return item.en;
        };
        
        // --- 2. ë Œë”ë§ ë° UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---

        const $ = (id) => document.getElementById(id);
        const $content = $('content-area');
        const $backButton = $('back-button');
        const $footerButtonArea = $('footer-button-area');
        const $footerBackButton = $('footer-back-button');
        const $langToggle = $('lang-toggle');

        function updateUI() {
            // 1. í—¤ë” ì–¸ì–´ í† ê¸€ ì—…ë°ì´íŠ¸
            $langToggle.textContent = language.toUpperCase();
            
            // 2. ë’¤ë¡œê°€ê¸° ë° í‘¸í„° ë²„íŠ¼ ê°€ì‹œì„± ì—…ë°ì´íŠ¸
            if (view === 'HOME') {
                $backButton.classList.add('hidden');
                $footerButtonArea.classList.add('hidden');
            } else if (view === 'INTERPRETATION') {
                $backButton.classList.remove('hidden');
                $footerButtonArea.classList.remove('hidden');
                $footerBackButton.textContent = category === 'PERSONALIZED' 
                    ? getUIText('BUTTON_BACK_PERSONALIZED', language)
                    : getUIText('BUTTON_BACK_SELECTION', language);
            } else { // SELECTION, PERSONALIZED_INPUT
                $backButton.classList.remove('hidden');
                $footerButtonArea.classList.add('hidden');
            }

            // 3. ë·°ì— ë§ëŠ” ì½˜í…ì¸  ë Œë”ë§
            renderContent();
        }
        
        function handleBackButtonClick() {
            if (view === 'INTERPRETATION') {
                // í•´ì„ í™”ë©´ì—ì„œ ë’¤ë¡œê°€ê¸° -> ê°œì¸ ì§ˆë¬¸ ë˜ëŠ” ì„ íƒ í™”ë©´ìœ¼ë¡œ
                if (category === 'PERSONALIZED') {
                    view = 'PERSONALIZED_INPUT';
                } else {
                    view = 'SELECTION';
                }
            } else if (view === 'SELECTION' || view === 'PERSONALIZED_INPUT') {
                // ì„ íƒ ë˜ëŠ” ì§ˆë¬¸ ì…ë ¥ í™”ë©´ì—ì„œ ë’¤ë¡œê°€ê¸° -> í™ˆ í™”ë©´ìœ¼ë¡œ
                view = 'HOME';
                category = null;
            }
            updateUI();
        }

        // --- 3. í•µì‹¬ ê¸°ëŠ¥: LLM API í˜¸ì¶œ í•¨ìˆ˜ (Exponential Backoff í¬í•¨) ---
        
        async function fetchInterpretation(query) {
            view = 'INTERPRETATION';
            $content.innerHTML = `
                <div class="flex flex-col items-center justify-center p-12 bg-gray-700 rounded-xl m-4 shadow-lg">
                    <div class="w-10 h-10 border-4 border-t-4 border-indigo-500 border-opacity-50 border-t-white rounded-full animate-spin"></div>
                    <span class="mt-4 text-white font-semibold text-center">${getUIText('LOADING_MESSAGE', language)}</span>
                </div>
            `;
            updateUI();
            
            let languageInstruction;
            let userQuery;
            
            // ì‚¬ìš©ì ì¿¼ë¦¬ ë° ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì˜ ì–¸ì–´ ì„¤ì •
            if (language === 'ko') {
                languageInstruction = 'í•´ì„ì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ ì£¼ì‹­ì‹œì˜¤. (Output Language: Korean)';
                userQuery = `ë‹¤ìŒ ì£¼ì œì— ëŒ€í•´ ì•ì„œ ì •ì˜ëœ ë„¤ ê°€ì§€ ì‹¤ì¡´ì  ì§ˆë¬¸ì— ì´ˆì ì„ ë§ì¶˜ ì‹¬ì¸µ í•´ì„ì„ ì œê³µí•˜ì‹­ì‹œì˜¤: "${query}"`;
            } else if (language === 'en') {
                languageInstruction = 'The interpretation must be written in English. (Output Language: English)';
                userQuery = `Provide a deep interpretation focused on the four existential questions defined above for the following topic: "${query}"`;
            } else { // lang === 'zh'
                languageInstruction = 'è¯·ç”¨ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰æ’°å†™è§£è¯»ã€‚ (Output Language: Simplified Chinese)';
                userQuery = `è¯·é’ˆå¯¹ä»¥ä¸‹ä¸»é¢˜ï¼Œæä¾›ä¸€ä¸ªèšç„¦äºå‰é¢å®šä¹‰çš„å››ä¸ªå­˜åœ¨ä¸»ä¹‰é—®é¢˜çš„æ·±åº¦è§£è¯»: "${query}"`;
            }

            const systemPrompt = `
                ${language === 'ko' ? 'ë‹¹ì‹ ì€ ì„¸ê³„ì ì¸ ìˆ˜ì¤€ì˜ í•™ë¬¸ì  ì„±ê²½ í•´ì„ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ìš”ì²­í•œ ì£¼ì œì— ëŒ€í•´ ê¹Šì´ ìˆê³  í¬ê´„ì ì¸ í•´ì„¤ì„ ì œê³µí•˜ì‹­ì‹œì˜¤.' : language === 'en' ? 'You are a world-class academic biblical interpreter. Provide a deep and comprehensive commentary on the topic requested by the user.' : 'æ‚¨æ˜¯ä¸–ç•Œçº§çš„å­¦æœ¯åœ£ç»è¯ é‡Šè€…ã€‚è¯·é’ˆå¯¹ç”¨æˆ·è¯·æ±‚çš„ä¸»é¢˜æä¾›æ·±å…¥è€Œå…¨é¢çš„è§£è¯»ã€‚'}
                
                **${language === 'ko' ? 'íŠ¹íˆ ë‹¤ìŒì˜ ì‹¤ì¡´ì , ì¸ê°„ë¡ ì  ì§ˆë¬¸ë“¤ì— ì´ˆì ì„ ë§ì¶° í•´ì„ì„ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ê° ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ëª…í™•í•˜ê²Œ ë§ˆí¬ë‹¤ìš´ ì„¹ì…˜ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì œì‹œí•˜ì‹­ì‹œì˜¤:' : language === 'en' ? 'Specifically, structure the interpretation by focusing on the following existential and anthropological questions. Clearly separate the answers to each question using markdown sections:' : 'ç‰¹åˆ«æ˜¯ï¼Œè¯·èšç„¦äºä»¥ä¸‹å­˜åœ¨ä¸»ä¹‰å’Œäººç±»å­¦é—®é¢˜æ¥ç»„ç»‡è§£è¯»ã€‚è¯·ä½¿ç”¨ Markdown æ˜ç¡®åˆ’åˆ†æ¯ä¸ªé—®é¢˜çš„ç­”æ¡ˆéƒ¨åˆ†ï¼š'}**
                
                ### ${language === 'ko' ? '1. ì¸ê°„ ì¡´ì¬ì˜ ëª©ì ê³¼ ì˜ë¯¸' : language === 'en' ? '1. Purpose and Meaning of Human Existence' : '1. äººç±»å­˜åœ¨çš„ç›®çš„ä¸æ„ä¹‰'}
                ${language === 'ko' ? 'ì´ ì£¼ì œê°€ ì¸ê°„ì˜ ë³¸ì§ˆê³¼ ì†Œëª…ì„ ì–´ë–»ê²Œ ë‹¤ë£¨ëŠ”ê°€?' : language === 'en' ? 'How does this topic address the essence and calling of humanity?' : 'è¿™ä¸ªä¸»é¢˜å¦‚ä½•å¤„ç†äººæ€§çš„æœ¬è´¨å’Œä½¿å‘½ï¼Ÿ'}
                
                ### ${language === 'ko' ? '2. ê³ í†µê³¼ ì•…ì˜ ë¬¸ì œ' : language === 'en' ? '2. The Problem of Suffering and Evil' : '2. è‹¦éš¾ä¸é‚ªæ¶çš„é—®é¢˜'}
                ${language === 'ko' ? 'ì´ ì£¼ì œ ì†ì—ì„œ ê³ ë‚œê³¼ ì£„ì•…ì€ ì–´ë–»ê²Œ ì„¤ëª…ë˜ê³  í•´ê²°ë˜ëŠ”ê°€?' : language === 'en' ? 'How are suffering and evil explained and resolved within this topic?' : 'åœ¨è¿™ä¸ªä¸»é¢˜ä¸­ï¼Œè‹¦éš¾å’Œç½ªæ¶æ˜¯å¦‚ä½•è¢«è§£é‡Šå’Œè§£å†³çš„ï¼Ÿ'}
                
                ### ${language === 'ko' ? '3. ë„ë•ê³¼ ìœ¤ë¦¬' : language === 'en' ? '3. Morality and Ethics' : '3. é“å¾·ä¸ä¼¦ç†'}
                ${language === 'ko' ? 'ì´ ì£¼ì œê°€ ì¸ê°„ì˜ ì±…ì„, ì •ì˜, ê·¸ë¦¬ê³  ì„ ì•…ì˜ ê¸°ì¤€ì— ëŒ€í•´ ì–´ë–¤ í†µì°°ì„ ì œê³µí•˜ëŠ”ê°€?' : language === 'en' ? 'What insight does this topic offer regarding human responsibility, justice, and the standard of good and evil?' : 'è¿™ä¸ªä¸»é¢˜åœ¨äººç±»è´£ä»»ã€æ­£ä¹‰ä»¥åŠå–„æ¶æ ‡å‡†æ–¹é¢æä¾›äº†å“ªäº›è§è§£ï¼Ÿ'}
                
                ### ${language === 'ko' ? '4. ê¶ê·¹ì  ìš´ëª…ê³¼ í¬ë§' : language === 'en' ? '4. Ultimate Destiny and Hope' : '4. ç»ˆæå‘½è¿ä¸å¸Œæœ›'}
                ${language === 'ko' ? 'ì´ ì£¼ì œê°€ ì‚¶ ì´í›„, ë˜ëŠ” ì¢…ë§ë¡ ì ì¸ ê´€ì ì—ì„œ ì¸ê°„ì—ê²Œ ì œì‹œí•˜ëŠ” í¬ë§ê³¼ ê²°ë§ì€ ë¬´ì—‡ì¸ê°€?' : language === 'en' ? 'What hope and conclusion does this topic present to humanity regarding life after death or from an eschatological perspective?' : 'è¿™ä¸ªä¸»é¢˜ä»ç”Ÿå‘½ä¹‹åæˆ–æœ«ä¸–è®ºçš„è§’åº¦ä¸ºäººç±»å‘ˆç°äº†æ€æ ·çš„å¸Œæœ›å’Œç»“å±€ï¼Ÿ'}
                
                ${language === 'ko' ? 'í•´ì„¤ì€ í•™ìˆ ì ì´ë©´ì„œë„ ëª…ë£Œí•˜ê³ , ì„±ê²½ ë³¸ë¬¸ì˜ ë¬¸ë§¥ì— ì¶©ì‹¤í•´ì•¼ í•©ë‹ˆë‹¤.' : language === 'en' ? 'The commentary must be academic yet clear, and faithful to the context of the biblical text.' : 'è§£è¯»åº”å…·æœ‰å­¦æœ¯æ€§ï¼ŒåŒæ—¶æ¸…æ™°æ˜äº†ï¼Œå¹¶å¿ å®äºåœ£ç»æ–‡æœ¬çš„ä¸Šä¸‹æ–‡ã€‚'}
                ${language === 'ko' ? 'ê²°ê³¼ë¬¼ì€ ì˜¤ì§ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ëœ í•´ì„¤ í…ìŠ¤íŠ¸ë¡œë§Œ êµ¬ì„±ë˜ì–´ì•¼ í•˜ë©°, ë¶ˆí•„ìš”í•œ ì„œë¡ ì´ë‚˜ ê²°ë¡  ë¬¸êµ¬ ì—†ì´ ìš”ì²­ëœ í•´ì„ì„ ë°”ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤. Markdownì„ ì‚¬ìš©í•˜ì—¬ í—¤ë”, ëª©ë¡, êµµì€ ê¸€ì”¨ ë“±ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì‹­ì‹œì˜¤.' : language === 'en' ? 'The output must consist only of the interpretation text in markdown, starting immediately without unnecessary introductory or concluding remarks. Use Markdown to clearly delineate headers, lists, and bold text.' : 'ç»“æœåº”ä»…åŒ…å« Markdown æ ¼å¼çš„è§£è¯»æ–‡æœ¬ï¼Œæ— éœ€ä¸å¿…è¦çš„å¼•è¨€æˆ–ç»“è®ºï¼Œç›´æ¥å¼€å§‹è¯·æ±‚çš„è§£è¯»å†…å®¹ã€‚è¯·ä½¿ç”¨ Markdown æ˜ç¡®åˆ’åˆ†æ ‡é¢˜ã€åˆ—è¡¨å’Œç²—ä½“æ–‡æœ¬ã€‚'}
                
                ---
                ${languageInstruction}
                ---
            `;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let interpretationText = getUIText('ERROR_FETCH_FAIL');
            let sources = [];
            
            for (let attempt = 0; attempt < 3; attempt++) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        interpretationText = candidate.content.parts[0].text;
                        const groundingMetadata = candidate.groundingMetadata;
                        
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attr => ({ uri: attr.web?.uri, title: attr.web?.title }))
                                .filter(source => source.uri && source.title);
                        }
                        break; // ì„±ê³µ ì‹œ ë£¨í”„ íƒˆì¶œ
                    } else {
                        throw new Error("API ì‘ë‹µì—ì„œ í•´ì„ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }

                } catch (err) {
                    console.error(`API call failed (attempt ${attempt + 1}):`, err);
                    if (attempt < 2) {
                        // Exponential Backoff: 1ì´ˆ, 2ì´ˆ ì§€ì—° í›„ ì¬ì‹œë„
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000));
                    }
                }
            }
            
            renderInterpretation(interpretationText, sources);
        }

        // --- 4. ë Œë”ë§ í•¨ìˆ˜ êµ¬í˜„ (View ë³„) ---
        
        function renderContent() {
            if (view === 'HOME') {
                renderHome();
            } else if (view === 'SELECTION') {
                renderSelection();
            } else if (view === 'PERSONALIZED_INPUT') {
                renderPersonalizedInput();
            }
            // INTERPRETATION ë·°ëŠ” fetchInterpretationì—ì„œ ì§ì ‘ ë Œë”ë§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
        }
        
        function renderHome() {
            // ì¹´í…Œê³ ë¦¬ ì„ íƒ í™”ë©´ (HOME) ë Œë”ë§
            $content.innerHTML = `
                <div class="grid grid-cols-2 gap-4 p-4">
                    ${CATEGORIES.map(cat => `
                        <button
                            class="category-btn flex flex-col items-center justify-center p-4 bg-gray-700 hover:bg-gray-600 rounded-xl shadow-lg transition duration-200 transform hover:scale-[1.02] text-white min-h-[100px] active:ring-4 active:ring-indigo-500"
                            data-category="${cat.id}"
                        >
                            <span class="text-3xl mb-1">${cat.icon}</span>
                            <span class="text-xs font-semibold text-center leading-tight">
                                ${cat[`name_${language}`]}
                            </span>
                        </button>
                    `).join('')}
                    <div class="col-span-2 mt-4 text-center text-gray-400 text-sm">
                        <p>${getUIText('EXPLORE_MESSAGE', language)}</p>
                    </div>
                </div>
            `;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    category = this.getAttribute('data-category');
                    if (category === 'PERSONALIZED') {
                        view = 'PERSONALIZED_INPUT';
                    } else {
                        view = 'SELECTION';
                    }
                    updateUI();
                });
            });
        }

        function renderSelection() {
            // ì£¼ì œ ì„¸ë¶€ í•­ëª© ì„ íƒ í™”ë©´ (SELECTION) ë Œë”ë§
            const currentCategoryName = CATEGORIES.find(c => c.id === category)?.[`name_${language}`] || getUIText('CATEGORY_SELECTION_TITLE', language, 'Topic');
            const data = SELECTION_DATA[category] || [];

            $content.innerHTML = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold mb-4 text-white border-b border-gray-600 pb-2">
                        ${getUIText('CATEGORY_SELECTION_TITLE', language, currentCategoryName)}
                    </h2>
                    <div id="item-list" class="space-y-3 max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar">
                        ${data.map((item, index) => `
                            <button
                                class="item-select-btn w-full text-left p-4 bg-gray-700 hover:bg-indigo-600 text-white rounded-lg transition duration-200 shadow-md text-sm active:ring-4 active:ring-indigo-500"
                                data-item-index="${index}"
                            >
                                ${getLocalizedItemName(item)}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;

            document.querySelectorAll('.item-select-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-item-index'));
                    const itemObject = SELECTION_DATA[category][index];
                    
                    selectedItem = getLocalizedItemName(itemObject);
                    const currentCategory = CATEGORIES.find(c => c.id === category);
                    const categoryName = currentCategory.en;
                    const itemQuery = getLLMQueryTopic(itemObject);
                    const fullQuery = `${categoryName} - ${itemQuery}`;
                    
                    fetchInterpretation(fullQuery);
                });
            });
        }
        
        function renderPersonalizedInput() {
            // ê°œì¸ ì§ˆë¬¸ ì…ë ¥ í™”ë©´ (PERSONALIZED_INPUT) ë Œë”ë§
            const bookOptions = SELECTION_DATA.BOOK; 

            $content.innerHTML = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold mb-4 text-white border-b border-indigo-500 pb-2">
                        ${getUIText('CUSTOM_TITLE', language)}
                    </h2>
                    <div class="space-y-6">
                        
                        <div>
                            <label for="contextBook" class="block text-gray-300 font-semibold mb-2 text-base">
                                ${getUIText('CUSTOM_PROMPT_1', language)}
                            </label>
                            <select 
                                id="contextBook"
                                class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white appearance-none focus:ring-2 focus:ring-indigo-500"
                            >
                                ${bookOptions.map(book => `
                                    <option value="${book.en}" ${book.en === contextualBook.en ? 'selected' : ''}>
                                        ${getLocalizedItemName(book)}
                                    </option>
                                `).join('')}
                            </select>
                        </div>

                        <div>
                            <label for="personalDilemma" class="block text-gray-300 font-semibold mb-2 text-base">
                                ${getUIText('CUSTOM_PROMPT_2', language)}
                            </label>
                            <textarea
                                id="personalDilemma"
                                class="w-full h-40 p-4 bg-gray-700 border border-gray-600 rounded-lg text-white resize-none placeholder-gray-400 focus:ring-2 focus:ring-indigo-500"
                                placeholder="${getUIText('CUSTOM_PLACEHOLDER', language)}"
                            >${personalQuery}</textarea>
                        </div>
                        
                        <button
                            id="generate-personal-btn"
                            class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition shadow-md active:ring-4 active:ring-indigo-500"
                        >
                            ${getUIText('CUSTOM_BUTTON', language)}
                        </button>
                        <p id="error-message" class="text-red-400 text-center mt-3 hidden"></p>
                    </div>
                </div>
            `;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë¶€ì°©
            $('contextBook').addEventListener('change', function() {
                const selectedEnName = this.value;
                // í˜„ì¬ ì„ íƒëœ contextualBook ê°ì²´ë¥¼ ì–¸ì–´ì™€ ê´€ê³„ì—†ì´ ì—…ë°ì´íŠ¸
                contextualBook = bookOptions.find(book => book.en === selectedEnName);
            });
            
            $('personalDilemma').addEventListener('input', function() {
                personalQuery = this.value;
                $('error-message').classList.add('hidden');
            });

            $('generate-personal-btn').addEventListener('click', function() {
                if (!personalQuery.trim()) {
                    const errorMessage = $('error-message');
                    errorMessage.textContent = getUIText('ERROR_NO_QUERY', language);
                    errorMessage.classList.remove('hidden');
                    return;
                }
                
                const langContext = language === 'ko' ? 'ë§¥ë½' : language === 'en' ? 'context' : 'èƒŒæ™¯';
                const bookDisplayName = getLocalizedItemName(contextualBook);
                const bookQueryName = getLLMQueryTopic(contextualBook);
                
                let fullQuery;
                // LLMì— ì „ë‹¬í•  ìµœì¢… ì¿¼ë¦¬ êµ¬ì„±
                if (language === 'ko') {
                    fullQuery = `í˜„ëŒ€ì  ë”œë ˆë§ˆ: "${personalQuery}"ì„/ë¥¼ ì„±ê²½ì˜ ë§¥ë½: "${bookQueryName}"ì— ë¹„ì¶”ì–´ í•´ì„í•´ ì£¼ì‹­ì‹œì˜¤.`;
                } else if (language === 'en') {
                    fullQuery = `Modern dilemma: "${personalQuery}". Please interpret this in light of the biblical context: "${bookQueryName}".`;
                } else {
                    fullQuery = `ç°ä»£å›°å¢ƒ: "${personalQuery}"ã€‚è¯·æ ¹æ®åœ£ç»èƒŒæ™¯: "${bookQueryName}" è¿›è¡Œè§£è¯»ã€‚`;
                }
                
                selectedItem = `${CATEGORIES.find(c => c.id === 'PERSONALIZED')[`name_${language}`]} (${bookDisplayName} ${langContext})`;
                fetchInterpretation(fullQuery);
            });
        }
        
        function renderInterpretation(text, sources) {
            // í•´ì„ ê²°ê³¼ í™”ë©´ (INTERPRETATION) ë Œë”ë§
            const currentCategory = CATEGORIES.find(c => c.id === category)?.[`name_${language}`];
            const title = getUIText('INTERPRETATION_TITLE', language, currentCategory, selectedItem);
            
            let sourceHtml = '';
            if (sources && sources.length > 0) {
                // ì¤‘ë³µ ì œê±° ë° ìœ íš¨í•œ ì†ŒìŠ¤ í•„í„°ë§ (ìµœëŒ€ 3ê°œ)
                const uniqueSources = Array.from(new Map(sources.map(item => [item.uri, item])).values())
                    .filter(source => source.uri && source.title)
                    .slice(0, 3);
                
                if (uniqueSources.length > 0) {
                    sourceHtml = `
                        <div class="mt-8 pt-4 border-t border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-400 mb-2">${getUIText('SOURCE_TITLE', language)}</h3>
                            <ul class="list-disc list-inside space-y-1">
                                ${uniqueSources.map(source => `
                                    <li class="text-sm text-blue-400 hover:text-blue-300">
                                        <a href="${source.uri}" target="_blank" rel="noopener noreferrer">${source.title}</a>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                }
            }
            
            // ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ë¥¼ HTMLë¡œ ë³€í™˜í•˜ëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜ (ì¤„ë°”ê¿ˆë§Œ ì²˜ë¦¬)
            const formatText = (text) => {
                // LLMì´ ë§ˆí¬ë‹¤ìš´ í—¤ë”ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìš”ì²­í–ˆìœ¼ë¯€ë¡œ, ê¸°ë³¸ ì¤„ë°”ê¿ˆì€ <br>ë¡œ ìœ ì§€í•˜ê³  ë§ˆí¬ë‹¤ìš´ ë³€í™˜ì€ CSSë¡œ ìŠ¤íƒ€ì¼ë§ë§Œ í•©ë‹ˆë‹¤.
                return text.replace(/\n/g, '<br>');
            };
            
            $content.innerHTML = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold mb-4 text-white text-center">
                        ${title}
                    </h2>
                    <div class="bg-gray-700 p-6 rounded-xl shadow-lg min-h-[300px] max-h-[70vh] overflow-y-auto custom-scrollbar">
                        <div class="text-gray-200 whitespace-pre-wrap leading-relaxed markdown-output">
                            ${formatText(text)}
                            ${sourceHtml}
                        </div>
                    </div>
                </div>
            `;
            updateUI(); // í‘¸í„° ë²„íŠ¼ì„ ë‹¤ì‹œ í‘œì‹œí•˜ê¸° ìœ„í•´
        }


        // --- 5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ---
        
        // ìƒë‹¨/í•˜ë‹¨ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì— ë™ì¼í•œ í•¸ë“¤ëŸ¬ ì—°ê²°
        $backButton.addEventListener('click', handleBackButtonClick);
        $footerBackButton.addEventListener('click', handleBackButtonClick);

        // ì–¸ì–´ í† ê¸€ ê¸°ëŠ¥
        $langToggle.addEventListener('click', function() {
            // ì–¸ì–´ ìˆœí™˜: ko -> en -> zh -> ko
            language = language === 'ko' ? 'en' : language === 'en' ? 'zh' : 'ko';
            // ì–¸ì–´ ë³€ê²½ ì‹œ í™ˆ í™”ë©´ìœ¼ë¡œ ë¦¬ì…‹
            view = 'HOME';
            category = null;
            contextualBook = SELECTION_DATA.BOOK[0]; 
            personalQuery = '';
            updateUI();
        });

        // ì•± ì‹œì‘ ì‹œ ì´ˆê¸° UI ë Œë”ë§
        window.onload = updateUI;
    </script>
</body>
</html>



